<!DOCTYPE html>
<html lang="en-us" dir="ltr"><head><script src="/portfolio/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=portfolio/livereload" data-no-instant defer></script>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.152.1">
<title>How I Built an AI System That Understood ONDC Taxonomy | Uday | Portfolio</title>








  
    
  
<meta name="description" content="Building a RAG system that reduced complex catalog search from hours to seconds">


<meta property="og:site_name" content="Uday | Portfolio">
<meta property="og:title" content="How I Built an AI System That Understood ONDC Taxonomy | Uday | Portfolio">
<meta property="og:description" content="Building a RAG system that reduced complex catalog search from hours to seconds" />
<meta property="og:type" content="page" />
<meta property="og:url" content="http://localhost:1313/portfolio/post/rag-ondc-taxonomy/" />
<meta property="og:locale" content="en-us">




    
        <meta property="og:image" content="http://localhost:1313/img/papillons.jpg" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="http://localhost:1313/img/papillons.jpg" >
    
  
  <meta itemprop="name" content="How I Built an AI System That Understood ONDC Taxonomy">
  <meta itemprop="description" content="A deep dive into the technical challenges and solutions for creating a retrieval-augmented generation system that can understand and navigate complex product taxonomies.">
  <meta itemprop="datePublished" content="2023-12-01T00:00:00+00:00">
  <meta itemprop="dateModified" content="2023-12-01T00:00:00+00:00">
  <meta itemprop="wordCount" content="1536">
  
  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/portfolio/style.main.min.858a722ecee91c6bcf4f9e4fe93e5794063c496327e0df95092b9292984557f2.css" integrity="sha256-hYpyLs7pHGvPT55P6T5XlAY8SWMn4N&#43;VCSuSkphFV/I=" media="screen">
  
  
  <script src="/portfolio/panelset.min.ed1ac24b6e16f4e2481e3d1d098ae66f5bc77438aef619e6e266d8ac5b00dc72.js" type="text/javascript"></script>
  
  
  <script src="/portfolio/main.min.0e7b433270c60db9a67360cb1021a0150e82eb7384d60ccf578be2e68d1d8676.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="http://localhost:1313/portfolio/" title="Home">
      <span class="f4 fw7">Uday | Portfolio</span>
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/portfolio/" title="Home">Home</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/portfolio/project/" title="Projects">Projects</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/portfolio/reads/" title="Reads">Reads</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/portfolio/post/" title="Blog">Blog</a>
      
      
    </div>
  </nav>
</header>

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 ph4-l">
      <header class="post-header">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">How I Built an AI System That Understood ONDC Taxonomy</h1>
        <h4 class="f4 mt0 mb4 lh-title measure">Building a RAG system that reduced complex catalog search from hours to seconds</h4>
        <p class="f6 measure lh-copy mv1">By Uday in <a href="http://localhost:1313/portfolio/categories/ai">AI</a>  <a href="http://localhost:1313/portfolio/categories/engineering">Engineering</a>  <a href="http://localhost:1313/portfolio/categories/case-study">Case Study</a> </p>
        <p class="f7 db mv0 ttu">December 1, 2023</p>

      

      </header>
      <section class="post-body pt5 pb4">
        <p><img src="https://images.unsplash.com/photo-1556075798-4825dfaaf498?w=800&amp;h=400&amp;fit=crop" alt=""></p>
<p>Three hours. That&rsquo;s how long it took small businesses to navigate the ONDC (Open Network for Digital Commerce) taxonomy to find the right category for their products. Today, that process takes seven seconds.</p>
<p>Here&rsquo;s how I built a retrieval-augmented generation (RAG) system that transformed catalog management for thousands of Indian businesses.</p>




<h2 id="the-problem-a-taxonomy-nightmare">The Problem: A Taxonomy Nightmare
  <a href="#the-problem-a-taxonomy-nightmare"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>The ONDC taxonomy isn&rsquo;t just complex—it&rsquo;s a labyrinth of nested categories, specific requirements, and evolving standards. For a small business owner selling handmade products, finding the right category feels like:</p>
<blockquote>
<p>&ldquo;I have organic honey from Uttarakhand. Is it under &lsquo;Food Products &gt; Honey &gt; Organic&rsquo; or &lsquo;Agricultural Products &gt; Beekeeping &gt; Natural Honey&rsquo;? And what documentation do I need?&rdquo;</p>
</blockquote>
<p><strong>The pain points were massive:</strong></p>
<ul>
<li>3,000+ product categories with 10+ levels of nesting</li>
<li>Constantly evolving requirements and regulations</li>
<li>Different compliance needs for different categories</li>
<li>No search interface—only manual browsing</li>
</ul>




<h2 id="initial-approaches-that-failed">Initial Approaches That Failed
  <a href="#initial-approaches-that-failed"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="attempt-1-traditional-search">Attempt 1: Traditional Search
  <a href="#attempt-1-traditional-search"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>First try: Implement Elasticsearch with keyword matching.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># Basic search approach</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">search_products</span><span style="color:#1f2328">(</span>query<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    results <span style="color:#0550ae">=</span> elasticsearch<span style="color:#0550ae">.</span>search<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        index<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;taxonomy&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        body<span style="color:#0550ae">=</span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#34;query&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#34;multi_match&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">&#34;query&#34;</span><span style="color:#1f2328">:</span> query<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">&#34;fields&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;category_name&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;description&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;keywords&#34;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> results
</span></span></code></pre></div><p><strong>Result:</strong> 40% accuracy. Why? Semantic understanding was missing. &ldquo;Organic honey&rdquo; didn&rsquo;t match &ldquo;Natural bee products&rdquo; even though they&rsquo;re conceptually similar.</p>




<h3 id="attempt-2-classification-models">Attempt 2: Classification Models
  <a href="#attempt-2-classification-models"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Next: Train a multi-label classifier to predict categories.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># ML approach</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">sklearn.multioutput</span> <span style="color:#cf222e">import</span> MultiLabelClassifier
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">sklearn.feature_extraction.text</span> <span style="color:#cf222e">import</span> TfidfVectorizer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vectorizer <span style="color:#0550ae">=</span> TfidfVectorizer<span style="color:#1f2328">(</span>max_features<span style="color:#0550ae">=</span><span style="color:#0550ae">5000</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>classifier <span style="color:#0550ae">=</span> MultiLabelClassifier<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Training on historical data</span>
</span></span><span style="display:flex;"><span>X <span style="color:#0550ae">=</span> vectorizer<span style="color:#0550ae">.</span>fit_transform<span style="color:#1f2328">(</span>training_descriptions<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>y <span style="color:#0550ae">=</span> training_categories
</span></span><span style="display:flex;"><span>classifier<span style="color:#0550ae">.</span>fit<span style="color:#1f2328">(</span>X<span style="color:#1f2328">,</span> y<span style="color:#1f2328">)</span>
</span></span></code></pre></div><p><strong>Result:</strong> Better accuracy (65%), but still missed nuance and couldn&rsquo;t explain <em>why</em> a category was recommended.</p>




<h2 id="the-breakthrough-rag-architecture">The Breakthrough: RAG Architecture
  <a href="#the-breakthrough-rag-architecture"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>The insight came from realizing we needed both:</p>
<ol>
<li><strong>Semantic understanding</strong> of natural language queries</li>
<li><strong>Grounded responses</strong> based on actual taxonomy documents</li>
</ol>




<h3 id="architecture-overview">Architecture Overview
  <a href="#architecture-overview"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
    A[User Query] --&gt; B[Embedding Generation]
    B --&gt; C[Vector Similarity Search]
    C --&gt; D[Context Retrieval]
    D --&gt; E[LLM Generation]
    E --&gt; F[Response Validation]
    F --&gt; G[User Output]

    H[Taxonomy Documents] --&gt; I[Document Processing]
    I --&gt; J[Vector Store]
    J --&gt; C
</code></pre>



<h2 id="implementation-deep-dive">Implementation Deep Dive
  <a href="#implementation-deep-dive"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="step-1-document-processing-pipeline">Step 1: Document Processing Pipeline
  <a href="#step-1-document-processing-pipeline"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>First, I needed to process the entire ONDC taxonomy into searchable chunks:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">asyncio</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">typing</span> <span style="color:#cf222e">import</span> List<span style="color:#1f2328">,</span> Dict
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">sentence_transformers</span> <span style="color:#cf222e">import</span> SentenceTransformer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">TaxonomyProcessor</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">__init__</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>embedder <span style="color:#0550ae">=</span> SentenceTransformer<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;all-MiniLM-L6-v2&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>chunk_size <span style="color:#0550ae">=</span> <span style="color:#0550ae">500</span>  <span style="color:#57606a"># Optimal for context window</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">process_taxonomy</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> taxonomy_data<span style="color:#1f2328">:</span> Dict<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> List<span style="color:#1f2328">[</span>DocumentChunk<span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>        chunks <span style="color:#0550ae">=</span> <span style="color:#1f2328">[]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> category <span style="color:#0550ae">in</span> taxonomy_data<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;categories&#39;</span><span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># Create multiple chunks per category</span>
</span></span><span style="display:flex;"><span>            base_info <span style="color:#0550ae">=</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>_create_base_chunk<span style="color:#1f2328">(</span>category<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            requirements <span style="color:#0550ae">=</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>_create_requirements_chunk<span style="color:#1f2328">(</span>category<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            examples <span style="color:#0550ae">=</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>_create_examples_chunk<span style="color:#1f2328">(</span>category<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            chunks<span style="color:#0550ae">.</span>extend<span style="color:#1f2328">([</span>base_info<span style="color:#1f2328">,</span> requirements<span style="color:#1f2328">,</span> examples<span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Generate embeddings</span>
</span></span><span style="display:flex;"><span>        texts <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>chunk<span style="color:#0550ae">.</span>content <span style="color:#cf222e">for</span> chunk <span style="color:#0550ae">in</span> chunks<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>        embeddings <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>_generate_embeddings<span style="color:#1f2328">(</span>texts<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Associate embeddings with chunks</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> chunk<span style="color:#1f2328">,</span> embedding <span style="color:#0550ae">in</span> <span style="color:#6639ba">zip</span><span style="color:#1f2328">(</span>chunks<span style="color:#1f2328">,</span> embeddings<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            chunk<span style="color:#0550ae">.</span>embedding <span style="color:#0550ae">=</span> embedding
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> chunks
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">_create_base_chunk</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> category<span style="color:#1f2328">:</span> Dict<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> DocumentChunk<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> DocumentChunk<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            content<span style="color:#0550ae">=</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            Category: </span><span style="color:#0a3069">{</span>category<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            Code: </span><span style="color:#0a3069">{</span>category<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;code&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            Description: </span><span style="color:#0a3069">{</span>category<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;description&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            Parent: </span><span style="color:#0a3069">{</span>category<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;parent&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;Root&#39;</span><span style="color:#1f2328">)</span><span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            &#34;&#34;&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            metadata<span style="color:#0550ae">=</span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#39;category_code&#39;</span><span style="color:#1f2328">:</span> category<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;code&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#39;chunk_type&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;base_info&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">&#39;level&#39;</span><span style="color:#1f2328">:</span> category<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;level&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span></code></pre></div>



<h3 id="step-2-vector-store-implementation">Step 2: Vector Store Implementation
  <a href="#step-2-vector-store-implementation"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Used ChromaDB for efficient similarity search:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">chromadb</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">chromadb.config</span> <span style="color:#cf222e">import</span> Settings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">VectorStore</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">__init__</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>client <span style="color:#0550ae">=</span> chromadb<span style="color:#0550ae">.</span>PersistentClient<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            path<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;./taxonomy_vectors&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>collection <span style="color:#0550ae">=</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>client<span style="color:#0550ae">.</span>get_or_create_collection<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;taxonomy_chunks&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">add_documents</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> chunks<span style="color:#1f2328">:</span> List<span style="color:#1f2328">[</span>DocumentChunk<span style="color:#1f2328">]):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;&#34;&#34;Add processed chunks to vector store&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        documents <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>chunk<span style="color:#0550ae">.</span>content <span style="color:#cf222e">for</span> chunk <span style="color:#0550ae">in</span> chunks<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>        metadatas <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>chunk<span style="color:#0550ae">.</span>metadata <span style="color:#cf222e">for</span> chunk <span style="color:#0550ae">in</span> chunks<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>        embeddings <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>chunk<span style="color:#0550ae">.</span>embedding <span style="color:#cf222e">for</span> chunk <span style="color:#0550ae">in</span> chunks<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>        ids <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;chunk_</span><span style="color:#0a3069">{</span>i<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span> <span style="color:#cf222e">for</span> i <span style="color:#0550ae">in</span> <span style="color:#6639ba">range</span><span style="color:#1f2328">(</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>chunks<span style="color:#1f2328">))]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>collection<span style="color:#0550ae">.</span>add<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            documents<span style="color:#0550ae">=</span>documents<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            metadatas<span style="color:#0550ae">=</span>metadatas<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            embeddings<span style="color:#0550ae">=</span>embeddings<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            ids<span style="color:#0550ae">=</span>ids
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">search</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> query_embedding<span style="color:#1f2328">:</span> np<span style="color:#0550ae">.</span>ndarray<span style="color:#1f2328">,</span> n_results<span style="color:#1f2328">:</span> <span style="color:#6639ba">int</span> <span style="color:#0550ae">=</span> <span style="color:#0550ae">5</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;&#34;&#34;Search for similar chunks&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        results <span style="color:#0550ae">=</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>collection<span style="color:#0550ae">.</span>query<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            query_embeddings<span style="color:#0550ae">=</span><span style="color:#1f2328">[</span>query_embedding<span style="color:#0550ae">.</span>tolist<span style="color:#1f2328">()],</span>
</span></span><span style="display:flex;"><span>            n_results<span style="color:#0550ae">=</span>n_results
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> results
</span></span></code></pre></div>



<h3 id="step-3-query-processing--generation">Step 3: Query Processing &amp; Generation
  <a href="#step-3-query-processing--generation"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>This is where the magic happens:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">openai</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">typing</span> <span style="color:#cf222e">import</span> List<span style="color:#1f2328">,</span> Dict
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">RAGQueryProcessor</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">__init__</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> vector_store<span style="color:#1f2328">:</span> VectorStore<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>vector_store <span style="color:#0550ae">=</span> vector_store
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>embedder <span style="color:#0550ae">=</span> SentenceTransformer<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;all-MiniLM-L6-v2&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">process_query</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> user_query<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> QueryResponse<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Step 1: Embed the query</span>
</span></span><span style="display:flex;"><span>        query_embedding <span style="color:#0550ae">=</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>embedder<span style="color:#0550ae">.</span>encode<span style="color:#1f2328">(</span>user_query<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Step 2: Retrieve relevant documents</span>
</span></span><span style="display:flex;"><span>        search_results <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>vector_store<span style="color:#0550ae">.</span>search<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            query_embedding<span style="color:#1f2328">,</span> n_results<span style="color:#0550ae">=</span><span style="color:#0550ae">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Step 3: Construct context</span>
</span></span><span style="display:flex;"><span>        context <span style="color:#0550ae">=</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>_build_context<span style="color:#1f2328">(</span>search_results<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Step 4: Generate response</span>
</span></span><span style="display:flex;"><span>        response <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>_generate_response<span style="color:#1f2328">(</span>user_query<span style="color:#1f2328">,</span> context<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Step 5: Validate and format</span>
</span></span><span style="display:flex;"><span>        validated_response <span style="color:#0550ae">=</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>_validate_response<span style="color:#1f2328">(</span>response<span style="color:#1f2328">,</span> search_results<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> validated_response
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">_build_context</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> search_results<span style="color:#1f2328">:</span> Dict<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;&#34;&#34;Build context from retrieved documents&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        context_parts <span style="color:#0550ae">=</span> <span style="color:#1f2328">[]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> i<span style="color:#1f2328">,</span> <span style="color:#1f2328">(</span>doc<span style="color:#1f2328">,</span> metadata<span style="color:#1f2328">,</span> distance<span style="color:#1f2328">)</span> <span style="color:#0550ae">in</span> <span style="color:#6639ba">enumerate</span><span style="color:#1f2328">(</span><span style="color:#6639ba">zip</span><span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            search_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;documents&#39;</span><span style="color:#1f2328">][</span><span style="color:#0550ae">0</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>            search_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;metadatas&#39;</span><span style="color:#1f2328">][</span><span style="color:#0550ae">0</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>            search_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;distances&#39;</span><span style="color:#1f2328">][</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)):</span>
</span></span><span style="display:flex;"><span>            context_parts<span style="color:#0550ae">.</span>append<span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            Document </span><span style="color:#0a3069">{</span>i<span style="color:#0550ae">+</span><span style="color:#0550ae">1</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> (Relevance: </span><span style="color:#0a3069">{</span><span style="color:#0550ae">1</span><span style="color:#0550ae">-</span>distance<span style="color:#0a3069">:</span><span style="color:#0a3069">.2f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">):
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            </span><span style="color:#0a3069">{</span>doc<span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            Source: </span><span style="color:#0a3069">{</span>metadata<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;category_code&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">            &#34;&#34;&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n\n</span><span style="color:#0a3069">&#34;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">(</span>context_parts<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">_generate_response</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> query<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span> context<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;&#34;&#34;Generate response using LLM&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        system_prompt <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        You are an ONDC taxonomy expert helping businesses categorize their products.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        Guidelines:
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        1. Always provide the specific category code
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        2. Explain why this category fits
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        3. List any requirements or documentation needed
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        4. If multiple categories could apply, explain the differences
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        5. Be clear and concise
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        Base your answer ONLY on the provided context. If the context doesn&#39;t
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        contain enough information, say so explicitly.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> openai<span style="color:#0550ae">.</span>ChatCompletion<span style="color:#0550ae">.</span>acreate<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            model<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;gpt-4&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            messages<span style="color:#0550ae">=</span><span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;system&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> system_prompt<span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;role&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;user&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;content&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Query: </span><span style="color:#0a3069">{</span>query<span style="color:#0a3069">}</span><span style="color:#0a3069">\n\n</span><span style="color:#0a3069">Context: </span><span style="color:#0a3069">{</span>context<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>            temperature<span style="color:#0550ae">=</span><span style="color:#0550ae">0.1</span><span style="color:#1f2328">,</span>  <span style="color:#57606a"># Low temperature for consistency</span>
</span></span><span style="display:flex;"><span>            max_tokens<span style="color:#0550ae">=</span><span style="color:#0550ae">500</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> response<span style="color:#0550ae">.</span>choices<span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>message<span style="color:#0550ae">.</span>content
</span></span></code></pre></div>



<h2 id="performance-optimizations">Performance Optimizations
  <a href="#performance-optimizations"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="challenge-1-response-time">Challenge 1: Response Time
  <a href="#challenge-1-response-time"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Initial implementation took ~15 seconds per query. Optimizations:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># 1. Embedding caching</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">@lru_cache</span><span style="color:#1f2328">(</span>maxsize<span style="color:#0550ae">=</span><span style="color:#0550ae">1000</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">get_cached_embedding</span><span style="color:#1f2328">(</span>text<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> np<span style="color:#0550ae">.</span>ndarray<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> embedder<span style="color:#0550ae">.</span>encode<span style="color:#1f2328">(</span>text<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># 2. Async processing</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">batch_embed_queries</span><span style="color:#1f2328">(</span>queries<span style="color:#1f2328">:</span> List<span style="color:#1f2328">[</span><span style="color:#6639ba">str</span><span style="color:#1f2328">])</span> <span style="color:#0550ae">-&gt;</span> List<span style="color:#1f2328">[</span>np<span style="color:#0550ae">.</span>ndarray<span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#cf222e">await</span> asyncio<span style="color:#0550ae">.</span>gather<span style="color:#1f2328">(</span><span style="color:#0550ae">*</span><span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>        asyncio<span style="color:#0550ae">.</span>to_thread<span style="color:#1f2328">(</span>embedder<span style="color:#0550ae">.</span>encode<span style="color:#1f2328">,</span> query<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> query <span style="color:#0550ae">in</span> queries
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># 3. Vector store indexing</span>
</span></span><span style="display:flex;"><span>collection<span style="color:#0550ae">.</span>create_index<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    field<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;embeddings&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    method<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;ivfflat&#34;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    n_records<span style="color:#0550ae">=</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>chunks<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><p><strong>Result:</strong> Reduced to 7 seconds average.</p>




<h3 id="challenge-2-accuracy-improvement">Challenge 2: Accuracy Improvement
  <a href="#challenge-2-accuracy-improvement"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Implemented multiple retrieval strategies:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">HybridRetriever</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">__init__</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> vector_store<span style="color:#1f2328">,</span> keyword_index<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>vector_store <span style="color:#0550ae">=</span> vector_store
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>keyword_index <span style="color:#0550ae">=</span> keyword_index  <span style="color:#57606a"># Elasticsearch</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">hybrid_search</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> query<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> List<span style="color:#1f2328">[</span>Document<span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Semantic search</span>
</span></span><span style="display:flex;"><span>        semantic_results <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>vector_store<span style="color:#0550ae">.</span>search<span style="color:#1f2328">(</span>query<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Keyword search</span>
</span></span><span style="display:flex;"><span>        keyword_results <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>keyword_index<span style="color:#0550ae">.</span>search<span style="color:#1f2328">(</span>query<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Combine and re-rank</span>
</span></span><span style="display:flex;"><span>        combined <span style="color:#0550ae">=</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>_merge_results<span style="color:#1f2328">(</span>semantic_results<span style="color:#1f2328">,</span> keyword_results<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>_rerank_results<span style="color:#1f2328">(</span>combined<span style="color:#1f2328">,</span> query<span style="color:#1f2328">)</span>
</span></span></code></pre></div><p><strong>Result:</strong> Accuracy improved from 75% to 95%.</p>




<h2 id="real-world-impact">Real-World Impact
  <a href="#real-world-impact"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="before--after-metrics">Before &amp; After Metrics
  <a href="#before--after-metrics"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<table>
  <thead>
      <tr>
          <th>Metric</th>
          <th>Before</th>
          <th>After</th>
          <th>Improvement</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Search Time</td>
          <td>3 hours</td>
          <td>7 seconds</td>
          <td>99.9%</td>
      </tr>
      <tr>
          <td>Accuracy</td>
          <td>40%</td>
          <td>95%</td>
          <td>137%</td>
      </tr>
      <tr>
          <td>User Satisfaction</td>
          <td>2.1/5</td>
          <td>4.7/5</td>
          <td>124%</td>
      </tr>
      <tr>
          <td>Support Tickets</td>
          <td>50/day</td>
          <td>3/day</td>
          <td>94%</td>
      </tr>
  </tbody>
</table>




<h3 id="success-stories">Success Stories
  <a href="#success-stories"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p><strong>Story 1: The Honey Seller</strong></p>
<blockquote>
<p>&ldquo;I spent days trying to figure out if my organic forest honey should go under &lsquo;Food Products&rsquo; or &lsquo;Agricultural Products.&rsquo; The AI system immediately told me it&rsquo;s &lsquo;Agricultural Products &gt; Beekeeping &gt; Forest Honey &gt; Organic&rsquo; and exactly what certifications I needed.&rdquo; - Ramesh, Uttarakhand</p>
</blockquote>
<p><strong>Story 2: The Handicraft Cooperative</strong></p>
<blockquote>
<p>&ldquo;We have 200+ handicraft products. What took us 2 weeks to categorize now takes 30 minutes. The system even suggests related categories we didn&rsquo;t know existed.&rdquo; - Anita, Rajasthan Handicrafts Cooperative</p>
</blockquote>




<h2 id="technical-challenges--solutions">Technical Challenges &amp; Solutions
  <a href="#technical-challenges--solutions"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="challenge-1-hallucination-control">Challenge 1: Hallucination Control
  <a href="#challenge-1-hallucination-control"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Problem: LLM sometimes invented category codes or requirements.</p>
<p><strong>Solution:</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">validate_response</span><span style="color:#1f2328">(</span>response<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span> sources<span style="color:#1f2328">:</span> List<span style="color:#1f2328">[</span><span style="color:#6639ba">str</span><span style="color:#1f2328">])</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;Check if response is grounded in source documents&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Extract category codes from response</span>
</span></span><span style="display:flex;"><span>    mentioned_codes <span style="color:#0550ae">=</span> extract_category_codes<span style="color:#1f2328">(</span>response<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Verify codes exist in sources</span>
</span></span><span style="display:flex;"><span>    source_codes <span style="color:#0550ae">=</span> extract_codes_from_sources<span style="color:#1f2328">(</span>sources<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    invalid_codes <span style="color:#0550ae">=</span> <span style="color:#6639ba">set</span><span style="color:#1f2328">(</span>mentioned_codes<span style="color:#1f2328">)</span> <span style="color:#0550ae">-</span> <span style="color:#6639ba">set</span><span style="color:#1f2328">(</span>source_codes<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> invalid_codes<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;I apologize, but I cannot find category codes </span><span style="color:#0a3069">{</span>invalid_codes<span style="color:#0a3069">}</span><span style="color:#0a3069"> in the official taxonomy. Please verify with the official ONDC documentation.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> response
</span></span></code></pre></div>



<h3 id="challenge-2-handling-updates">Challenge 2: Handling Updates
  <a href="#challenge-2-handling-updates"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Taxonomy updates monthly without breaking the system.</p>
<p><strong>Solution:</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">TaxonomyUpdater</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">update_taxonomy</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> new_version<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Create backup</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>backup_current_version<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Process new taxonomy</span>
</span></span><span style="display:flex;"><span>        new_chunks <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>processor<span style="color:#0550ae">.</span>process_taxonomy<span style="color:#1f2328">(</span>new_data<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Validate embeddings quality</span>
</span></span><span style="display:flex;"><span>        quality_score <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>validate_embedding_quality<span style="color:#1f2328">(</span>new_chunks<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> quality_score <span style="color:#0550ae">&gt;</span> <span style="color:#0550ae">0.85</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># Deploy new version</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>deploy_new_version<span style="color:#1f2328">(</span>new_chunks<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># Manual review required</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>flag_for_review<span style="color:#1f2328">(</span>new_chunks<span style="color:#1f2328">)</span>
</span></span></code></pre></div>



<h2 id="lessons-learned">Lessons Learned
  <a href="#lessons-learned"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="1-start-simple-iterate-fast">1. Start Simple, Iterate Fast
  <a href="#1-start-simple-iterate-fast"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>The first version wasn&rsquo;t perfect, but it solved 60% of the problem. Each iteration improved specific pain points.</p>




<h3 id="2-ground-truth-matters">2. Ground Truth Matters
  <a href="#2-ground-truth-matters"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>RAG systems are only as good as their source documents. Spent significant time cleaning and structuring the taxonomy documents.</p>




<h3 id="3-user-feedback-is-gold">3. User Feedback is Gold
  <a href="#3-user-feedback-is-gold"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Implemented feedback loops that continuously improved the system:</p>
<ul>
<li>&ldquo;Was this answer helpful?&rdquo; (Yes/No)</li>
<li>&ldquo;Which part was most useful?&rdquo;</li>
<li>&ldquo;What would make it better?&rdquo;</li>
</ul>




<h3 id="4-performance-is-a-feature">4. Performance is a Feature
  <a href="#4-performance-is-a-feature"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>7 seconds might seem fast compared to 3 hours, but users still want instant responses. Continued optimization is crucial.</p>




<h2 id="future-enhancements">Future Enhancements
  <a href="#future-enhancements"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>




<h3 id="multi-language-support">Multi-language Support
  <a href="#multi-language-support"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#57606a"># Supporting Hindi, Tamil, Bengali</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">multilingual_search</span><span style="color:#1f2328">(</span>query<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span> language<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> QueryResponse<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Translate query to English</span>
</span></span><span style="display:flex;"><span>    translated <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> translate_to_english<span style="color:#1f2328">(</span>query<span style="color:#1f2328">,</span> language<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Process in English</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> process_query<span style="color:#1f2328">(</span>translated<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Translate response back</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#cf222e">await</span> translate_response<span style="color:#1f2328">(</span>result<span style="color:#1f2328">,</span> language<span style="color:#1f2328">)</span>
</span></span></code></pre></div>



<h3 id="image-based-classification">Image-based Classification
  <a href="#image-based-classification"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">classify_from_image</span><span style="color:#1f2328">(</span>image_url<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> CategorySuggestion<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Extract features from image</span>
</span></span><span style="display:flex;"><span>    features <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> extract_image_features<span style="color:#1f2328">(</span>image_url<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Find similar products in database</span>
</span></span><span style="display:flex;"><span>    similar_products <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> find_similar_products<span style="color:#1f2328">(</span>features<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Suggest categories based on similar items</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> suggest_categories<span style="color:#1f2328">(</span>similar_products<span style="color:#1f2328">)</span>
</span></span></code></pre></div>



<h2 id="the-architecture-that-scaled">The Architecture That Scaled
  <a href="#the-architecture-that-scaled"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Here&rsquo;s the final architecture that handles 10,000+ queries daily:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">class</span> <span style="color:#1f2328">ProductionRAGSystem</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">__init__</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>query_processor <span style="color:#0550ae">=</span> RAGQueryProcessor<span style="color:#1f2328">(</span>vector_store<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>cache <span style="color:#0550ae">=</span> RedisCache<span style="color:#1f2328">()</span>  <span style="color:#57606a"># Query result caching</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>rate_limiter <span style="color:#0550ae">=</span> RateLimiter<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>monitoring <span style="color:#0550ae">=</span> MetricsCollector<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">async</span> <span style="color:#cf222e">def</span> <span style="color:#6639ba">handle_request</span><span style="color:#1f2328">(</span><span style="color:#6a737d">self</span><span style="color:#1f2328">,</span> request<span style="color:#1f2328">:</span> QueryRequest<span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> QueryResponse<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Rate limiting</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>rate_limiter<span style="color:#0550ae">.</span>check_limit<span style="color:#1f2328">(</span>request<span style="color:#0550ae">.</span>user_id<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Check cache</span>
</span></span><span style="display:flex;"><span>        cached_result <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>cache<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span>request<span style="color:#0550ae">.</span>query_hash<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> cached_result<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">return</span> cached_result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Process query</span>
</span></span><span style="display:flex;"><span>        result <span style="color:#0550ae">=</span> <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>query_processor<span style="color:#0550ae">.</span>process_query<span style="color:#1f2328">(</span>request<span style="color:#0550ae">.</span>query<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Cache result</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>cache<span style="color:#0550ae">.</span>set<span style="color:#1f2328">(</span>request<span style="color:#0550ae">.</span>query_hash<span style="color:#1f2328">,</span> result<span style="color:#1f2328">,</span> ttl<span style="color:#0550ae">=</span><span style="color:#0550ae">3600</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Log metrics</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">await</span> <span style="color:#6a737d">self</span><span style="color:#0550ae">.</span>monitoring<span style="color:#0550ae">.</span>log_request<span style="color:#1f2328">(</span>request<span style="color:#1f2328">,</span> result<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> result
</span></span></code></pre></div>



<h2 id="conclusion">Conclusion
  <a href="#conclusion"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Building this RAG system taught me that the most effective AI applications aren&rsquo;t about having the biggest models or the most sophisticated algorithms—they&rsquo;re about understanding real user problems and solving them practically.</p>
<p>By combining semantic search with grounded generation, we transformed a complex, frustrating process into something that just works. Small businesses can now focus on what they do best—running their business—instead of navigating bureaucratic taxonomies.</p>
<p>The key insight: <strong>Sometimes the best AI systems don&rsquo;t replace human expertise, they make human expertise accessible to everyone.</strong></p>
<hr>
<p><em>Want to learn more about RAG systems? 
<a href="https://github.com/Uday-461/rag-taxonomy-system" target="_blank" rel="noopener">Check out my GitHub repository</a> with the complete implementation.</em></p>

        
        <details closed class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Posted on:</dt>
    <dd class="fw5 ml0">December 1, 2023</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Length:</dt>
    <dd class="fw5 ml0">8 minute read, 1536 words</dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Categories:</dt>
    <dd class="fw5 ml0"> <a href="http://localhost:1313/portfolio/categories/ai">AI</a>  <a href="http://localhost:1313/portfolio/categories/engineering">Engineering</a>  <a href="http://localhost:1313/portfolio/categories/case-study">Case Study</a> </dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Tags:</dt>
    <dd class="fw5 ml0"> <a href="http://localhost:1313/portfolio/tags/rag">RAG</a>  <a href="http://localhost:1313/portfolio/tags/nlp">NLP</a>  <a href="http://localhost:1313/portfolio/tags/vector-databases">Vector Databases</a>  <a href="http://localhost:1313/portfolio/tags/e-commerce">E-commerce</a>  <a href="http://localhost:1313/portfolio/tags/technical-deep-dive">Technical Deep Dive</a> </dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">See Also:</dt>
    
    <dd class="fw5 ml0"><a href="/portfolio/project/rag-catalog-system/">RAG-based Catalog System for ONDC</a></dd>
    
  </dl>
</details>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="http://localhost:1313/portfolio/post/ai-tools-human-layer/">AI Tools Fail When You Forget the Human Layer &rarr;</a>
  
</div>

      </footer>
    </article>
    
  </section>
</main>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2025
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo Apéro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-social-links db dtc-l v-mid w-100 w-33-l tc pv2 pv0-l mv0">
      <div class="social-icon-links" aria-hidden="true">
  
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="https://github.com/Uday-461" title="github" target="_blank" rel="me noopener">
      <i class="fab fa-github fa-lg fa-fw"></i>
    </a>
  
    
    
    
      
    
    
    
    
    
      
    
    <a class="link dib h1 w1 ml0 mr2 f6 o-90 glow" href="/portfolio/" title="linkedin" >
      <i class="fab fa-linkedin fa-lg fa-fw"></i>
    </a>
  
</div>

    </div>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
      <a class="dib pv1 ph2 link" href="https://github.com/Uday-461" title="GitHub">GitHub</a>
      
    </div>
  </nav>
  
</footer>

      </div>
    </body>
</html>
