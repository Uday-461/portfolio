{{ $page := . }}                           <!--save current page-->
{{ $section := $page.CurrentSection }}     <!--save branch section-->
{{ $root := .Scratch.Get "$root" }}        <!--save root section-->

<article class="w-100 w-50-m w-third-l mb4 pb4 bb bw1 bw0-ns pb0-ns read-card {{ if .Params.external_url }}read-card--external{{ end }}">
  <!--if show_post_thumbnail is TRUE in root-->
  {{ if $root.Params.show_post_thumbnail }}
  <div class="ph0 ph2-m ph3-l">
    <!--featured image for the leaf bundle-->
    {{- $images := $page.Resources.ByType "image" -}}
    {{ $leaf := $images.GetMatch "*feature*" }}
    {{- $hex := $images.GetMatch "*hex*" -}}
    {{- $thumbnail := cond (ne $hex nil) $hex $leaf -}}
    <!--sidebar image for the branch bundle-->
    {{ $branch := ($section.Resources.ByType "image").GetMatch "*feature*" }}
    {{- $thumbnail := cond (ne $thumbnail nil) $thumbnail $branch -}}
    <div class="aspect-ratio aspect-ratio--1x1 {{ if (ne $hex nil) }}contain{{ else }}cover{{ end }} dim"{{ with $thumbnail }}style="background: url('{{ .RelPermalink | absURL }}') center center no-repeat"{{ end }}>
      {{ if .Params.external_url }}
        <a href="{{ .Params.external_url }}" class="w-100 absolute top-0 bottom-0" target="_blank" rel="noopener"></a>
      {{ else }}
        <a href="{{ .Permalink }}" class="w-100 absolute top-0 bottom-0"></a>
      {{ end }}
    </div>
  </div>
  {{ end }}
  <div class="ph0 pa2-m pa3-l">
    <header>
      <!-- Content Type Badge -->
      {{ with .Params.content_type }}
      <span class="content-type-badge content-type-badge--{{ . }}">
        {{ if eq . "video" }}üé• Video
        {{ else if eq . "article" }}üìù Article
        {{ else if eq . "podcast" }}üéß Podcast
        {{ else if eq . "social_post" }}üíº Post
        {{ else if eq . "book" }}üìö Book
        {{ else }}{{ . }}
        {{ end }}
      </span>
      {{ end }}
      
      <h1 class="f3 f4-l mv2 lh-title fw4">
        {{ if .Params.external_url }}
          <a href="{{ .Params.external_url }}" class="db" target="_blank" rel="noopener">{{ .Title | markdownify }} ‚Üó</a>
        {{ else }}
          <a href="{{ .RelPermalink }}" class="db">{{ .Title | markdownify }}</a>
        {{ end }}
      </h1>
      
      {{ with .Params.subtitle }}
        <h2 class="f5 fw4 mv1 gray">{{ . }}</h2>
      {{ end }}
      
      {{ range first 1 (.GetTerms "series") }}
        <h2 class="f5"><i class="fas fa-stream fa-fw pr1"></i><small class="f5 ttu tracked">Series: </small><a class="link i dim" href="{{ $section.RelPermalink }}">{{ .LinkTitle }}</a></h2>
      {{ end }}
    </header>
    
    {{ $summary := cond (ne .Params.excerpt nil) .Params.excerpt .Summary }}
    {{ with $summary }}<p class="f6 lh-copy">{{ . | markdownify | emojify }}</p>{{ end }}
    
    <!--ensures section Params are respected-->
    <footer>
      <!-- Platform and duration info -->
      <div class="mb2">
        {{ with .Params.platform }}
          <span class="platform-badge platform-badge--{{ lower . }}">{{ . }}</span>
        {{ end }}
        {{ with .Params.duration }}
          <span class="time-indicator">{{ . }}</span>
        {{ else }}
          {{ with .Params.reading_time }}
            <span class="time-indicator">{{ . }}</span>
          {{ end }}
        {{ end }}
      </div>
      
      {{ if $root.Params.show_author_byline }}
        <p class="f7 db mv1">
          {{ if .Params.author }}By {{ .Params.author }}{{ end }}
          {{ with .Params.categories }} in{{ range . }} <a href="{{ "categories/" | absURL }}{{ . | urlize }}">{{ . }}</a> {{ end }}{{ end }}
        </p>
      {{ end }}
      
      {{ if $root.Params.show_post_date }}
        <p class="f7 db mv1">{{ .PublishDate.Format "January 2, 2006" }}</p>
      {{ end }}
      
      <!-- External link button -->
      {{ if .Params.external_url }}
        <a href="{{ .Params.external_url }}" class="external-link f6 dib mt2" target="_blank" rel="noopener">
          View Original
        </a>
      {{ else if and $root.Params.show_button_links .Params.links }}
        <p class="db pt1">
          {{ partial "shared/btn-links.html" . }}
        </p>
      {{ end }}
    </footer>
  </div>
</article>

